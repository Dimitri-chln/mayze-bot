import { Client, Snowflake, Collection, StreamDispatcher, VoiceConnection, VoiceState } from "discord.js";
import { BetterMessage } from "../../../utils/better-discord/src";
import { Video, Playlist as YoutubePlaylist } from "youtubei";
import ytsr from "ytsr";

interface PlayerEvents {
    channelEmpty: [message: BetterMessage, queue: Queue];
    songAdd: [message: BetterMessage, queue: Queue, song: Song];
    playlistAdd: [message: BetterMessage, queue: Queue, playlist: Playlist];
    queueEnd: [message: BetterMessage, queue: Queue];
    songChanged: [message: BetterMessage, newSong: Song, oldSong: Song];
    songFirst: [message: BetterMessage, song: Song];
    error: [error: String, message: BetterMessage];
    clientDisconnect: [message: BetterMessage, queue: Queue];
    clientUndeafen: [message: BetterMessage, queue: Queue]
}
type PlayOptions = {
    search: String;
    uploadDate: 'hour' | 'today' | 'week' | 'month' | 'year';
    duration: 'short' | 'long';
    sortBy: 'relevance' | 'date' | 'view count' | 'rating';
    requestedBy: String;
    index: Number;
}

type PlaylistOptions = {
    search: String;
    maxSongs: Number;
    requestedBy: String;
    shuffle: Boolean;
}
type ProgressOptions = {
    size: Number;
    arrow: String;
    block: String;
}
type PlayerOptions = {
    leaveOnEnd: Boolean;
    leaveOnStop: Boolean;
    leaveOnEmpty: Boolean;
    deafenOnJoin: Boolean;
    timeout: Number;
    volume: Number;
    quality: 'high' | 'low';
}

export class Player {
    constructor(client: Client, options: PlayerOptions);
    client: Client;
    options: PlayerOptions;
    queues: Map<String, Queue>;
    ytsr: any;
    nowPlayings: Collection<Snowflake, BetterMessage>;

    public on<K extends keyof PlayerEvents>(event: K, listener: (...args: PlayerEvents[K]) => void): this;
    isPlaying(message: BetterMessage): Boolean;
    play(message: BetterMessage, options: PlayOptions | String): Promise<Song>;
    addToQueue(message: BetterMessage, options: PlayOptions | String): Promise<Song>;
    seek(message: BetterMessage, seek: Number):Promise<Song>;
    playlist(message: BetterMessage, options: PlaylistOptions | String): Promise<Playlist>;
    pause(message: BetterMessage): Song;
    resume(message: BetterMessage): Song;
    stop(message: BetterMessage): Song;
    setVolume(message: BetterMessage, percentage: Number): Song;
    getVolume(message: BetterMessage): Number;
    getQueue(message: BetterMessage): Queue;
    setQueue(message: BetterMessage, songs: Song[]): Queue;
    clearQueue(message: BetterMessage): Queue;
    skip(message: BetterMessage): Song;
    skipTo(message: BetterMessage, index: Number): Song;
    nowPlaying(message: BetterMessage): Song;
    setQueueRepeatMode(message: BetterMessage, enabled: Boolean): Boolean;
    setRepeatMode(message: BetterMessage, enabled: Boolean): Boolean;
    toggleLoop(message: BetterMessage): Boolean;
    toggleQueueLoop(message: BetterMessage): Boolean;
    move(message: BetterMessage, index: Number, position: Number): Song;
    remove(message: BetterMessage, songs: String[]): Song[];
    shuffle(message: BetterMessage): Song[];
    createProgressBar(message: BetterMessage, options?: ProgressOptions): String;
    updateQueueOptions(message: BetterMessage, options?: PlayerOptions): void;
    _playSong(guildID: String, firstPlay: Boolean, seek?: Number): void;
}

export class Queue {
    constructor(guildID: Snowflake, options: Object, message: BetterMessage);
    guildID: Snowflake;
    dispatcher: StreamDispatcher;
    connection: VoiceConnection;
    songs: Song[];
    stopped: Boolean;
    skipped: Boolean;
    volume: Number;
    playing: Boolean;
    repeatMode: Boolean;
    repeatQueue: Boolean;
    initMessage: BetterMessage;
    options: PlayerOptions;
    duration: Number;
}

export class Song {
    constructor(video: Video, queue: Queue, requestedBy: String);
    name: String;
    duration: String | Number;
    author: String;
    url: String;
    thumbnail: String;
    queue: Queue;
    isLive: Boolean;
    requestedBy: String;
    seekTime: Number;
}

export class Playlist {
    constructor(playlist: YoutubePlaylist, queue: Queue, requestedBy: String);
    name: String;
    author: String;
    url: String;
    videos: Song[];
    videoCount: Number;
}

export class MusicPlayerError {
    constructor(error: String);
    type: String;
    message: String;
}

export class Util {
    PlayerOptions: PlayOptions;
    PlayOptions: PlayOptions;
    PlaylistOptions: PlaylistOptions;
    ProgessOptions: ProgressOptions;
    getVideoBySearch(search: String, options: object, queue: Queue, requestedBy: String): Promise<Song>;
    getVideoFromPlaylist(search: String, max: Number, queue: Queue, requestedBy: String): Promise<Playlist>;
    songFromSpotify(query: String): Promise<String>;
    MillisecondsToTime(ms: Number): String;
    TimeToMilliseconds(time: String): Number;
    buildBar(value: Number, maxValue: Number, size: Number, loadedIcon: String, arrowIcon: String): String;
    deserializeOptionsPlayer(options: Partial<PlayerOptions>): PlayerOptions | Partial<PlayerOptions>;
    deserializeOptionsPlay(options: Partial<PlayOptions> | String): Partial<PlayOptions>;
    deserializeOptionsPlaylist(options: Partial<PlaylistOptions> | String): Partial<PlaylistOptions>;
    deserializeOptionsProgress(options: Partial<ProgressOptions>): Partial<ProgressOptions>;
    isVoice(voice: VoiceState): Boolean;
    shuffle(array: []): [];
}

export const Utils: Util;
export const version: String;